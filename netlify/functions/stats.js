const fetch=require("node-fetch"),cyrb53=function(a,e=0){let o=3735928559^e,r=1103547991^e;for(let e=0,t;e<a.length;e++)t=a.charCodeAt(e),o=Math.imul(o^t,2654435761),r=Math.imul(r^t,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&r)+(o>>>0)},handler=async e=>{if("POST"!==e.httpMethod)return{statusCode:405,body:"Method Not Allowed"};if(null==e.body)return{statusCode:400,body:"Bad Request"};if(-1!==e.headers["user-agent"].indexOf("Algolia"))return{statusCode:200,body:"Not counting you!"};var t=JSON.parse(e.body),a=e.headers["x-nf-client-connection-ip"],o=a+";"+e.headers["user-agent"]+";"+t.language+";",o=cyrb53(o).toString(16);const r=[["v","1"],["t",t.type],["tid","UA-113124215-3"],["aip","1"],["uip",a],["cid",o],["geoid",e.headers["x-country"]],["ul",t.language],["ua",e.headers.useragent]];"pageview"===t.type?(r.push(["dt",t.title]),r.push(["dl",t.url]),r.push(["dr",t.ref]),r.push(["sr",t.resolution]),r.push(["vp",t.viewport])):"event"===t.type&&(r.push(["ec",t.eventCategory]),r.push(["ea",t.eventAction]),r.push(["el",t.eventLabel]));t=new URLSearchParams(r);try{var u=await fetch("https://www.google-analytics.com/collect?"+t,{method:"POST",cache:"no-cache"});if(u.ok)return{statusCode:u.status,body:u.statusText}}catch(e){}};module.exports={handler:handler};